<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TIFFY Test Notifier</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      background: black;
      color: white;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    button {
      background: gold;
      border: none;
      padding: 15px 25px;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
    }
    #status {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Test TIFFY Notification</h1>
  <button id="notifyBtn">Enable Notifications</button>
  <div id="status"></div>

  <script>
  let swRegistration;

  // Register service worker and store reference
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
      .then((registration) => {
        console.log('‚úÖ Service Worker Registered');
        swRegistration = registration;
      })
      .catch((err) => console.error('‚ùå SW error:', err));
  }

  const notifyBtn = document.getElementById('notifyBtn');
  const status = document.getElementById('status');

  notifyBtn.onclick = async () => {
    if (!('Notification' in window)) {
      status.innerText = "‚ùå Your browser doesn't support notifications.";
      return;
    }

    const permission = await Notification.requestPermission();
    if (permission !== 'granted') {
      status.innerText = "üîï Notifications are blocked.";
      return;
    }

    status.innerText = "‚úÖ TIFFY alerts are ON every 3 minutes!";
    startReminderLoop();
  };

  function startReminderLoop() {
    // First one after 10s
    setTimeout(() => {
      sendNotificationToSW();
    }, 10000);

    // Then every 3 mins
    setInterval(() => {
      sendNotificationToSW();
    }, 180000); // 3 min = 180000 ms
  }

  function sendNotificationToSW() {
    if (swRegistration && navigator.serviceWorker.controller) {
      navigator.serviceWorker.controller.postMessage({
        type: 'SHOW_NOTIFICATION'
      });
    } else {
      console.warn('‚ö†Ô∏è Service worker not ready yet.');
    }
  }
</script>
</body>
</html>
